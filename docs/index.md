# Меню

1. [О Театре][about]
	1. [Коротко][about/in-brief]
	2. [История][about/history]
		1. Малыщицкий
		2. Падве
		3. Спивак
	3. [Техническое оснащение][about/technical-equipment]
		1. Малая сцена
		2. Большая сцена
	4. [Друзья Театра][about/friends]
2. [Репертуар][performances]
	1. [Текущий репертуар][performances/current]
	2. [Архив или Все спектакли][performances/all]
		1. По годам
		2. По алфавиту
	3. [Готовится к постановке][performances/upcoming]
3. [Афиша][timetable]
4. [Люди Театра][persons]
5. [Контакты][get-in-touch]
	1. [Телефоны][get-in-touch/contacts]
	2. [Гостевая][get-in-touch/feedback]
6. [Визит в Театр][visit]
	1. [Покупка билетов][visit/tickets]
	2. [Этикет][visit/etiquette]
	3. [Как добраться][visit/directions]
	4. [Презентационный ролик][visit/watch]
7. [Пресс-клуб][press]
	1. [Новости][press/articles]
	2. [PROсцениум][press/proscenium]
	3. [Молодёжка][press/molodezhka]
	4. [Дайджест СМИ][press/media-digest]

Предлагаемый общий вид страницы сайта:

__Логотип__. Логотип театра располагается в верхней части страницы. Он должен быть заметным и читаемым (в прямом и переносном смысле).

__Главное меню__. Корневые элементы приведённой выше структуры. Располагается в верхней части страницы.

> Логотип и главное меню могут внешне отличаться на главной и внутренних страницах сайта.

__Ссылка на страницу поиска__. Ссылка должна распологаться отдельно от главного меню, например в правом верхнем углу. [Описание страницы поиска][search].

__Второстепенное меню__. Появляется только после входа в один из разделов.


__Третьестепенное меню__. Появляется на некоторых страницах, например [История][about/history].

__Основное содержимое страницы__.

__Подвал__. В подвале структура меню будет немного отличаться. Раздел «Афиша» должен быть помещён в раздел «Репертуар» первым подпунктом. Раздел «Люди Театра», при отображении в подвале, нужно отнести к «О Театре» первым подпунктом. Также в подвале отображается меню только до второго уровня. И т.к. все элементы 1-го уровня производят перенаправление на своих 1-х потомков, то в подвале их можно сделать неактивными (не ссылками).

В подвал можно разместить пару телефонов и email для «быстрых контактов».

<a name="possible-domain-names"></a>__Возможные доменные имена__:

* молодёжный-на-фонтанке.рф
* молодёжный-театр-на-фонтанке.рф
* молодежный-на-фонтанке.рф
* молодежный-театр-на-фонтанке.рф
* mtfontanka.ru (занят какими-то спамерами)
* mtfontanka.spb.ru

# Главная страница
>	url: /

## Содержимое главной страницы

__Новости__. Список последних новостей. В тексте должна отображаться краткая версия новости (атрибут `Краткое описание` ресурса «[Новость][press/articles/attributes]»). Более подробно формат отображения списка описан в разделе [Новости][press/articles]. Показывается некоторое количество новостей от текущей даты на 10 дней вперёд, но не меньше 2-х и от текущей новости на 30 дней назад, но не менее 10-ти. Новости фильтруются по атрибуту `Дата привязки` ресурса «[Новость][press/articles/attributes]»

__Блоки с данными__. Несколько блоков с одной картинкой и одним параграфом текста. Желаемое количество блоков определяется дизайнером (как вариант 3-5 штук). Логическая структура описана ниже в разделе «Администрирование главной страницы».

__Календарь__. Небольшой календарь где должны быть отмечены дни, в которые есть спектакли. При щелчке на число отображается список спектаклей на конкретный день. Максимальный набор спектаклей может быть примерно таким: детский спектакль с утра на одной из сцен, 2 вечерних спектакля на 2-х сценах и, может оказаться, вечером в афише будет значиться 3-й спектакль, который играется на чужой сцене (однако это крайне редкий случай. Как правило — один или два спектакля в день). Пожелания к оформлению подобного списка можно посмотреть в разделе [Афиша][timetable].

> Взаимное расположение блоков с данными, новостей и календаря определяется дизайнером. Не обязательно соблюдать приведённый выше порядок.

<!-- `TODO` Что ещё? -->

## _Администрирование главной страницы_

На странице администрирования «главной страницы» должен выводиться список «Блоков с данными» и их статус (см. [описание ресурсов][tech-resources]). Список сортируется по статусу и по дате создания. Список отображается в виде таблицы со следующими колонками:

* Название
* Статус

На главной странице показываются только блоки со статусом _опубликован_.

### _Атрибуты ресурса «Блок с данными»_

* Ссылка
* Название
* Текст
* Медиа

Атрибуты `Название` и `Текст` обязательны к заполнению.

Ресурс «Блок с данными» ни при каких условиях не будет полным, т.е. ссылки на него всегда будут неактивными.

#### Атрибут `Ссылка`
Ссылка на внешний или внутренний ресурс. Если ссылка ведёт на внутренний ресурс, он _опубликован_ и содержит атрибут `Краткое описание` (Новость, Спектакль, Персоналия, Файл, Статическая страница), то его значение помещается в атрибут `Текст`, который потом, при желании, можно отредактировать. А значение атрибута `Название` помещается в соответствующий атрибут ресурса «Блок с данными».

Правила вставки и обработки ссылок можно посмотреть в разделе [ссылки на ресурсы][tech-links].

#### Атрибут `Название`
Название блока. Копируется из связанного ресурса, если он внутренний или вводится вручную, если ресурс внешний.

#### Атрибут `Текст`
Текстовое содержимое блока, один или два параграфа по 300–500 знаков. Копируется из связанного ресурса, если он внутренний и у него есть атрибут `Краткое описание`. Текст без изображений. Может быть отредактирован [умеренным текстовым редактором][tech-editor-medium].

#### Атрибут `Медиа`
Изображение (скорее всего, для единообразия блоков, размеры изображения должны быть заранее оговорены. Например высота — 200px, а ширина произвольная или фиксирована и ширина и высота), видеоролик или аудиозапись. Для медиа элемента можно задать заголовок на странице создания ресурса «блок с данными». Все медиа элементы должны попадать в общую [базу файлов][files]. Либо они могут быть выбраны из этой базы (с фильтрацией по типу).

Ессли атрибут `ссылка` указывает на ресурс «Файл», то медиа файл берётся из этого ресурса. 

# <a name="about"></a> О Театре
>	url: /about

При нажатии на ссылку [О Театре][about] должно происходить внутреннее (скрытое от пользователя, т.е. в адресной строке должен отображаться адрес страницы «О театре») перенаправление на страницу [Коротко][about/in-brief].

## _Администрирование подразделов «О Театре»_

Должна быть возможность редактировать разделы «Коротко», «История» (3 части в отдельности), «Друзья театра» так, как описано в [технических замечаниях по статическим страницам][tech-staticpages].

## <a name="about/in-brief"></a> Коротко
>	url: /about/in-brief

Действительно короткий текст с одной или двумя иллюстрациями описывающими театр в целом. Здесь можно разместить _один_ презентационный ролик.

В конце текста нужно разместить ссылку для перехода в раздел [История][about/history]. Это может быть сделано с помощью редактора статических страниц.

<!-- `TODO` Подумать как и куда можно добавить остальные ролики, если они появятся -->

## <a name="about/history"></a> История
>	url: /about/history

>	anchors: #Малыщицкий, #Падве, #Спивак

Здесь предполагается полное описание истории театра, структурированное по художественным руководителям. Текст приблизительно на 15000 знаков вперемешку с изображениями (и/или другими медиа-материалами). Возможно, имеет смысл разместить изображения блоками в виде симпатичной галереи под каждым из 3-х этапов.

Рассказывается как переход от одного худрука к другому, при заходе на страницу показывается история целиком, но по вышеприведённым ссылкам-якорям (именам художественных руководителей) можно провести фильтрацию.

## <a name="about/technical-equipment"></a> Техническое оснащение
>	url: /about/technical-equipment

>	anchors: #Большая-сцена, #Малая-сцена, #Райдер-спектаклей

Техническое оснащение 2-х сцен. Схемы 2-х сцен. Может быть пару слов к схемам.

Статическая страница. Смотри описание [статических страниц][tech-staticpages].

> Дизайнер должен прорисовать оформление страницы с техническим оснащением сцен. Для этого ему нужно знать, что вообще входит в понятие *техническое оснащение сцены*. Для этой-же страницы потребуется отрисовать качественные схемы 2-х сцен.

## <a name="about/friends"></a> Друзья театра
>	url: /about/friends

Обычная статическая страница, на которой можно разместить ссылки с кратким описанием и, возможно, описанием.

Например, на странице будут размещены следующие ссылки:

* Мир Молодёжки
* Буквоед
* Спонсоры

# <a name="performances"></a> Репертуар
>	url: /performances

При нажатии на ссылку [Репертуар][performances] должно происходить внутреннее (скрытое от пользователя, т.е. в адресной строке должен отображаться адрес страницы «Репертуар») перенаправление на страницу [Текущий репертуар][performances/current].

## _Администрирование раздела «Репертуар»_

Спектакли в интерфейсе администрирования выводятся в виде таблицы со следующими колонками:

* Название спектакля
* Год постановки и периоды жизни на сцене. Или признак того, что спектакль готовится к постановке
* Статус (см. [описание типовых ресурсов][tech-resources])

Должна быть возможность фильтрации и сортировка таблицы по перечисленным колонкам. В дополнение предполагается наличие фильтра, позволяющего отобразить спектакли из текущего репертуара и/или готовящиеся к постановке.

### _Атрибуты ресурса «Спектакль»_

Ресурс «Спектакль» наследуется от ресурса «[Статическая страница][tech-staticpages]», от которого наследуются атрибуты: «Название», «Краткое описание», «Блоки».

* Название. _Унаследован от ресурса «Статическая страница»_
* Краткое описание. _Унаследован от ресурса «Статическая страница»_
* Блоки (Подробное описание). _Унаследован от ресурса «Статическая страница»_
* Продолжительность
* Количество актов
* Примечание для Афиши
* Лица, задейстованные в спектакле
* Года жизни спектакля на сцене
* Пьеса
* Автор пьесы
* Признак того, что спектакль детский
* Медиа

Атрибут `Название` является обязательным.

Ресурс «Спектакль» считается полным, если заполнены атрибуты `Название` и `Блоки` (как минимум 1 текстовый блок, см. описание атрибута ниже).

> Возможно дизайнер нарисует страницу спектакля так, что будет необходимым наличие изображений, тогда для полноты ресурса потребуется наличие атрибута `Медиа`.

#### Атрибут `Название`
Название спектакля, как будет показано в репертуаре. Нельзя позволять вводить в качестве названия спектакля следующие строки:

* all
* current
* upcoming

#### Атрибут `Краткое описание`
Желателен к заполнению. Для редактирования атрибута используется [умеренный текстовый редактор][tech-editor-medium].

#### Атрибут `Блоки` (Подробное описание)
Т.к. ресурс «Спектакль» наследован от ресурса «[Статическая страница][tech-staticpages]», то способ редактирования тот-же. Но для целей ресурса «Спектакль» фиксируется количество блоков — 1 и тип блока — текстовый, в который вводится подробное описание.

> Возможно по требованию дизайна количество блоков и их тип нужно будет изменить.

#### Атрибут `Продолжительность`
Приблизительная продолжительность спектакля в минутах (без учёта антрактов). При отображении времени на странице спектакля, нужно приплюсовывать продолжительность антрактов.

#### Атрибут `Количество актов`
Количество актов.

#### Атрибут `Примечание для Афиши`
Краткое примечание, которое будет показано в Афише, например: «получил премию...». Для редактирования атрибута используется [облегчённый текстовый редактор][tech-editor-small].

#### Атрибут `Лица, задействованные в спектакле`
Список всех лиц, которых автор описания спектакля посчитал нужным внести (актёры, режиссёры, художники и т.п.). Каждый элемент списка характеризуется следующими атрибутами:

* Ссылка на ресурс «Персоналия», если таковая имеется в базе сайта
* Имя лица, задействованного в спектакле (если выбрана ссылка на ресурс, то имя берётся из ресурса «Персоналия». Важно заметить, что не копируется, а просто ставится ссылка и при всех запросах к этому полю возвращается значени из ресурса на который установлена ссылка)
* Как относится лицо к этому спектаклю. Базовый список отношений должен быть определён заранее (необходимо иметь возможность его редактировать на отдельной странице). Если нужного значения нет в базовом списке, пользователь должен иметь возможность самостоятельно ввести нужный текст. Предварительный список базовых значений:
	* Режиссёр
	* Актёр
	* Режиссёр по пластике
	* Художник-постановщик
	* Художник по свету
	* Художник по костюмам
	* Художник по музыке
	* Музыкальный оформитель
	* Композитор
	* Сценограф
* Примечание для показа на странице спектакля и актёра. В примечании нужно указывать, что участник получил премию за роль в этом спектакле или другую важную информацию. Для редактирования атрибута используется [облегчённый текстовый редактор][tech-editor-small].

Для `актёра` добавляются следующие атрибуты:

* Название роли исполняемой актёром в этом спектакле (в единственном числе)
* Название роли во множественном числе (пример: солдат/солдаты. 1-е отображается на странице актёра, 2-е на странице спектакля)
* Признак того, играет ли данный актёр эту роль в текущий момент
* Показывать ли эту роль на странице Актёра (атрибут имеет значение, только если установлена ссылка на ресурс «Персоналия». Как правило, такие роли просто не будут вноситься в базу, но на всякий случай атрибут предусмотрен)
* Признак того, что роль играется несколькими составами (задаётся после того, как весь список актёров отредактирован)
* Признак того, что актёр был «введён» на эту роль
* Дата «ввода» в спектакль (задаётся если выставлен признак, указанный в предыдущем пункте)
* Фотографии актёра в этом спектакле. Для фотографии можно задать заголовок на странице редактирования списка. Все фотографии должны попадать в общую [базу файлов][files]. Либо они могут быть выбраны из этой базы (с фильтрацией по типу).

`TODO` Вопрос не исследовал, но скорее всего есть возможность формировать название во множественном числе автомагически.

При модификации этого списка, если каким-либо образом изменился набор актёров, необходимо вывести все роли (в скобках через запятую перечислить всех актёров для которых указана текущая роль) для того, чтобы автор смог указать какие роли из списка играются в нескольких составах, а какие просто «толпой».

Список лиц можно отсортировать. Этот порядок будет использован при отображении страницы спектакля.

При создании ресурса «Спектакль» и обновлении списка актёров, необходимо предупредить пользователя, что, скорее всего, требуется обновление страниц актёров (имеется ввиду обновление свободной текстовой информации атрибута `Блоки` ресурса «Спектакль») и написание новостей. Ниже выводится список возможных причин для написания новостей и редактирования страницы «[Персоналии][persons]»:

* «_Имя актёра_» играет роль «_название роли_» в спектакле «_название спектакля_» (для актёров)
* «_Имя персоналии_» участвует в качестве «_отношение к постановке_» в спектакле «_название спектакля_» (для всех остальных лиц)
* «_Имя актёра_» вводится на роль «_название роли_» в спектакле «_название спектакля_»
* «_Имя актёра_» уходит с роли «_название роли_» в спектакле «_название спектакля_»
* Снятие спектакля «_название спектакля_» с репертуара

<!-- `TODO` что-то ещё? -->

#### <a name="performances/attrs/timespans"></a> Атрибут `Года жизни спектакля на сцене`
Набор отрезков и лучей задающий промежутки времени жизни спектакля на сцене Молодёжного театра. Если правый конец периода не задан (луч), то считается что спектакль сейчас находится в репертуаре. Естественно луч может быть только один и он должен быть крайним в списке, отсортированном по дате начала. Также запрещается пересечение отрезков, кроме одной точки (начало или конец промежутка). Каждый из фиксированных концов отрезков и лучей может быть задан с точностью до дня (а может и менее точно, например — год).

Необходимо предупреждать пользователя, если он выбрал в качестве даты окончания промежутка — дату больше текущей. Это может быть верно, если заранее известно что возобновление спектакля произошло на короткий промежуток или если известна дата закрытия спектакля. Но есть вероятность, что это просто ошибка.

Также этот атрибут вместо набора промежутков может содержать информацию о том, что спектакль готовится к постановке.

#### Атрибут `Пьеса` и `Автор пьесы`
Простые текстовые поля ввода.

#### Атрибут `Признак того, что спектакль детский`
Значение типа правда/ложь.

#### Атрибут `Медиа`
Фотографии, Видеофрагменты, Аудиофрагменты. Элементы медиа можно пометить для использования в галерее, оформлении страницы спектакля, списке спектаклей в репертуаре, афише (можно установить один или более флагов). В оформлении страницы спектакля и списке спектаклей могут быть использованы только к фотографии.

Для медиа элементов можно задать заголовок на странице создания ресурса «спектакль». Все медиа элементы должны попадать в общую [базу файлов][files]. Либо они могут быть выбраны из этой базы (с фильтрацией по типу).

Можно разбить этот атрибут на два или три. Если потребуется, то фотографию можно загрузить дважды.

> Дизайнер должен определить, как будут использованы эти изображения, и нужно ли вообще в списке спектаклей в репертуаре показывать изображения? Скорее всего, далеко не все спектакли будут иметь подобные изображения.

## <a name="performances/current"></a> Текущий репертуар
>	url: /performances/current

Список спектаклей в репертуаре на текущий момент времени (на момент показа страницы пользователю). По алфавиту.

В списке, показываемом конечному пользователю, отображаются только _опубликованные_ ресурсы типа «спектакль» с учётом описанного выше условия. В этом списке показывается название и краткое описание постановки и, возможно, некоторые другие доступные атрибуты ресурса, на усмотрение дизайнера.

Если ресурс _полный_, то `название` спектакля должно отображаться в виде ссылки, нажав на которую пользователь попадает на страницу спектакля.

> Дизайнеру определить, что показывать в списке помимо `названия` спектакля и `краткого описания`.

## <a name="performances/all"></a> Все спектакли
>	url: /performances/all

>	anchors: #по-годам, #по-алфавиту

Все спектакли, которые присутствуют в базе сайта (все _опубликованные_ ресурсы типа «спектакль»).

С помощью 2-х якорей можно будет отобразить список либо в алфавитном порядке, либо в хронологическом.

При отображении в хронологическом порядке спектакли группируются по году постановки. В начале списка показываются самые «свежие» спектакли. Каждый спектакль показывается только один раз под годом первой постановки. Спектакли, для которых не указан год постановки, отображаются в самом хвосте списка.

При отображении по алфавиту сортировка производится от А-Я, далее по числам (алгоритм natural order sort), а потому уже A-Z.

Над списком нужно отобразить индекс букв и цифр. При этом русские буквы и арабские цифры показывать все, но ссылками делать только те, которые есть в списке (имеется ввиду первый символ названия), а все остальные — только те, что реально присутствуют.

<!-- `TODO` Давать ли настраивать порядок сортировки. Может стоит просто над списком отобразить индекс букв и цифр. При этом русские буквы и арабские цифры показывать все, но ссылками делать только те, которые есть в списке (имеется ввиду конечно-же первый символ названия), а все остальные — только те, что реально присутствуют.  -->

Оформление элементов списка такое же, как и при отображении [текущего репертуара][performances/current].

<!-- `TODO` Нужна-ли разбивка на страницы если элементов в списке слишком много? -->

## <a name="performances/upcoming"></a> Готовится к постановке
>	url: /performances/upcoming

Список спектаклей, которые готовятся к постановке.

Оформление элементов списка и способ отображения такой же, как и у [текущего репертуара][performances/current].

## Страница спектакля
>	url: /performances/<Название>

>	url: /performances/<id>

URL на страницу спектакля может содержать атрибут `Название` при наличии технической возможности. 

Если есть несколько ресурсов с одинаковым названием, то первый из них (по времени создания) показывается с оригинальным названием, а последующим в скобках дописывается год постановки (если год постановки не указан, то дописывается идентификатор ресурса).

<!-- `TODO` Может добавить в ресурс атрибут `название для URL`, который должен быть уникален среди однотипных элементов и неизменяем? -->

На странице спектакля желательно отображение всех атрибутов ресурса «спектакль» в том виде, котором дизайнер посчитал подходящим.

Также помимо атрибутов ресурса нужно показать даты ближайших показов этого спектакля. И кнопка «Заказать билеты».

Скорее всего, лица типа актёр будут показаны отдельно, сгруппированные по ролям.

Порядок лиц задаётся тем порядком, который задан на этапе создания. Если лица сгруппированы (актёры), то порядок групп определяется первым актёром в отсортированном списке лиц.

> Более подробное описание появится после того, как дизайнер отрисует эту страницу.

# <a name="timetable"></a> Афиша
>	url: /timetable

Афиша представляет из себя плоский список без деления на колонки малая/большая, показывающий представления на ближайшие 30 дней. В списке должно быть хорошо видно, к какому месяцу относится элемент.

`ПРИМЕЧАНИЕ` Не стоит делить афишу на 2 колонки. Во-первых, будут неаккуратные дыры, а во-вторых, непонятно куда помещать, например, Касатку в ДК Ленсовета.

Зайдя на страницу афиши, посетитель должен отыскать нужную дату и/или спектакль. Название сцены, на которой проходит спектакль, должно быть заметно, но не доминировать над датой и названием. С большинства элементов афиши будут выставлены ссылки (можно делать названия спектаклей ссылками, а можно как-то иначе, зависит от дизайнера) на спектакли из базы, на другой ресурс сайта (скорее всего это будет ссылка на новость в которой подробнее описывается конкретное событие) или на внешний ресурс открываемый в новом окне (например, на сайт театра дождей, арендующего сцену, с описанием постановки).

У элементов афиши могут быть метки, например: Премьера, Спектакль месяца, Бенефис...

Ещё у каждого элемента афиши может быть  примечание, в котором можно разместить название театра, арендующего сцену, или ещё что-нибудь. В тексте могут присутствовать ссылки, но они не должны сильно выделяться (можно сделать их того-же цвета, что и текст и подчеркнуть пунктиром).

Также в списке должно быть предусмотрено место для расположения кнопки «Заказать билеты».

`TODO` механизм работы заказа билетов и механизм определения доступности билетов. Пока неизвестен.

## _Администрирование раздела «Афиша»_

Элементы афиши на странице администрирования выводятся в виде календаря (похожего на Google Calendar. Например [FullCalendar](http://arshaw.com/fullcalendar/)). Цветом в календаре можно отмечать сцену проведения представления, а уровнем прозрачности – статус (_опубликован_/_неопубликова_).

При создании события в календаре продолжительность должна проставляться автоматически, а время начала выставляться равным 19-ти часам по будням и 18-ти – по выходным для взрослых спектаклей, и 11:30 для детских спектаклей.

Администирование афиши должно быть спроектировано таким образом, что-бы пользователю было удобно вводить по несколько значений сразу.

При редактировании прошедших событий пользователь должен быть предупреждён, что редактируется уже прошедшее событие.

### _Атрибуты ресурса «Элемент афиши»_

* Дата проведения
* Ссылка
* Название
* Площадка проведения (сцена)
* Метки
* Дополнительная информация

Атрибуты «Дата проведения», «Название представления» и «Площадка проведения (сцена)» являются обязательными.

Ресурс ни при каких условиях не будет полным, т.е. ссылки на него всегда будут неактивными.

#### Атрибут `Дата проведения`
Дата проведения мероприятия. При выборе даты, находящейся в прошлом или дальше 2-х месяцев, необходимо предупреждать пользователя (ненавязчиво) о потенциальной ошибке.

#### Атрибут `Ссылка`
Этот атрибут желательно выбирать (вводить) после выбора даты, т.к. только на основании даты можно отсортировать список спектаклей так, что-бы на вершине он содержал спектакли из текущего репертуара. Рядом с полем для выбора спектакля указывать примечание, что если вы не видите нужного спектакля в списке, то его забыли создать, либо он не из репертуара театра.

Ссылка может быть установлена путём выбора из элемента из репертуара, тогда атрибут содержит url адрес ресурса «Спектакль», недоступный для ручного редактирования. Второй способ – ввести ссылку вручную, например на ресурс «Новость» или внешний адрес (см. [ввод и обработка ссылок][tech-links]).

#### Атрибут `Название`
Если атрибут `Cсылка` указывает на ресурс «Спектакль», то название берётся (НЕ копируется) из соответствующего атрибута ресурса «Спектакль» и не может быть отредактировано вручную.

#### Атрибут `Площадка проведения (сцена)`
Выбор из списка «Малая сцена», «Большая сцена» или ввод вручную (например ДК Ленсовета).

#### Атрибут `Метки`
Набор текстовых меток. Метка «Премьера» должна быть добавлена автоматически если выполнены следующие условия:

* один из первых 10-ти показов
* НЕ возобновление

Наиболее часто использующиеся метки должны быть “под рукой”. Изначально в списке должны находиться «Премьера» и «Спектакль месяца».

#### Атрибут `Дополнительная информация`
В этом атрибуте можно ввести пару строчек информации. Для ввода описания используется [облегчённый текстовый редактор][tech-editor-small].

Если ресурс «Элемент афиши» имеет связь с ресурсом «Спектакль», то начальное значение берётся (копируется) из атрибута `Примечание для Афиши` ресурса «Спектакль». При изменении этой связи значение дополнительной информации должно меняться, даже если пользователь уже отредактировал этот атрибут.

# <a name="persons"></a> Люди Театра
>	url: /persons

Выводится списком, сгруппированным в три блока:

* Художественный руководитель
* Актёры в составе труппы
* Актёры вне труппы

Признак принадлежности труппе можно получить из атрибута `Находится в составе труппы` ресурса «Персоналия».

## _Администрирование раздела «Люди Театра»_

Персоналии в интерфейсе администрирования выводятся в виде таблицы со следующими колонками:

* Название (ФИО)
* Признак нахождения в трупп
* Статус (см. [описание типовых ресурсов][tech-resources])

Должна быть возможность фильтрации и сортировка таблицы по перечисленным колонкам.

### _Атрибуты ресурса «Персоналия»_
Ресурс «Персоналия» наследуется от ресурса «[Статическая страница][tech-staticpages]», от которого наследуются атрибуты: «Название», «Краткое описание», «Блоки».

* Название (ФИО). _Унаследован от ресурса «Статическая страница»_
* Краткое описание. _Унаследован от ресурса «Статическая страница»_
* Блоки. _Унаследован от ресурса «Статическая страница»_
* Дата рождения
* Место рождения
* Пол
* Года работы в театре
* Должность
* Находится в составе труппы
* Медиа

<!-- `TODO` Года жизни? -->

Атрибут `Название` является обязательным.

Ресурс «Персоналия» считается полным, если заполнены атрибуты `Название` и `Блоки` (как минимум 1 текстовый блок, см. описание атрибута ниже).

<!-- Формирование фразы родился 10-го января в усть-алымске формировать полуавтоматически -->

#### Атрибут `Название`
В этот атрибут вводится Фамилия Имя и Отчество персоналии.

#### Атрибут `Краткое описание`
Желателен к заполнению. Для редактирования атрибута используется [умеренный текстовый редактор][tech-editor-medium].

#### Атрибут `Блоки`
Т.к. ресурс «Персоналия» наследован от ресурса «[Статическая страница][tech-staticpages]», то способ редактирования тот же. Пользователю предлагается набор заготовленных названий текстовых блоков:

* общие слова (биографическая справка)
* сыгранные роли
* сейчас в репертуаре
* роли репертуара в других театрах и антреприза
* работы в кино и сериалы
* детские спектакли
* премии
* телевидение и радио

Остальные блоки можно добавить, если потребуется.

#### Атрибут `Дата рождения`
День и Месяц рекомендованы к заполнению, а год — по желанию.

#### Атрибут `Место рождения`
Место рождения персоналии — текстовое поле.

#### Атрибут `Пол`
Пол персоналии.

<!-- #### Атрибут `Регалии` -->

#### Атрибут `Года работы в театре`
Набор отрезков и лучей задающий временя работы в Молодёжном театре. Способ задания отрезков можно посмотреть в описании атрибута `[Года жизни спектакля на сцене][performances/attrs/timespans]`, единственное отличие — атрибут может хранить только даты, а признака «Персоналия скоро поступит на работу» не нужно.

#### Атрибут `Должность`
Текстовое поле, в которое можно вписать должность. По умолчанию «Актёр». Также возможен вариант — Художественный руководитель.

#### Атрибут `Находится в составе труппы`
Булевый атрибут. По умолчанию `true`. Имеет значение только если `должность` — актёр.

#### Атрибут `Медиа`
Фотографии, Видеофрагменты, Аудиофрагменты. Элементы медиа можно пометить для использования в галерее, оформлении страницы персоналии, списке персоналий. В оформлении страницы персоналии и списке персоналий могут быть использованы только к фотографии.

Для медиа элементов можно задать заголовок на странице создания ресурса «персоналия». Все медиа элементы должны попадать в общую [базу файлов][files]. Либо они могут быть выбраны из этой базы (с фильтрацией по типу).

Можно разбить этот атрибут на два или три. Если потребуется, то фотографию можно загрузить дважды.

> Дизайнер должен определить, как будут использованы эти изображения и нужно ли вообще в списке персоналий показывать изображения.

## Страница Персоналии
>	url: /persons/<Название>

>	url: /persons/<id>

URL на страницу персоналии может содержать атрибут Название, при наличии технической возможности.

Если есть несколько ресурсов с одинаковым названием, то первый из них (по времени создания) показывается с оригинальным названием, а последующим в скобках дописывается дата рождения (дата рождения не указана, то дописывается идентификатор ресурса).

На странице персоналии желательно отображение всех атрибутов ресурса «персоналия» в том виде, котором дизайнер посчитал подходящим.

Также помимо атрибутов ресурса нужно выводить спектакли из репертуара театра в которых персоналия принимает участие (нужно учесть, что для художественного руководителя нельзя написать «репертуар актёра в Молодёжном театре»). Рядом с теми ролями, которые будут показываться в ближайшие 30 дней показать даты ближайших показов. Примечания, заданные при формировании списка актёрского состава ресурса «Спектакль», показываются здесь-же. 

Те роли, которые играются несколькими составами, должны быть особым образом помечены.

# <a name="get-in-touch"></a> Контакты
>	url: /get-in-touch

При нажатии на ссылку [Контакты][get-in-touch] должно происходить внутреннее (скрытое от пользователя, т.е. в адресной строке должен отображаться адрес страницы «Контакты») перенаправление на страницу [Телефоны][get-in-touch/contacts].

## <a name="get-in-touch/contacts"></a> Телефоны
>	url: /get-in-touch/contacts

Статическая страница. Смотри описание [статических страниц][tech-staticpages].

## <a name="get-in-touch/feedback"></a> Гостевая
>	url: /get-in-touch/feedback

Модерируемая гостевая книга с защитой от спама и возможностью владельцам сайта комментировать некоторые сообщения. Сообщение ответа должно отличаться оформлением от основного сообщения.

Запись гостевой книги содержит имя автора, дату сообщения и текст сообщения. Текст сообщения должен набираться с помощью [умеренного варианта текстового редактора][tech-editor-medium].

Отображаемый список сообщений должен разбиваться по 20 страниц на страницу. На первой странице в самом верху отображается самое последнее сообщение.

# <a name="visit"></a> Визит в Театр
>	url: /visit

При нажатии на ссылку [Визит в Театр][visit] должно происходить внутреннее (скрытое от пользователя, т.е. в адресной строке должен отображаться адрес страницы «Визит в Театр») перенаправление на страницу [Покупка билетов][visit/tickets].

## <a name="visit/tickets"></a> Покупка билетов
>	url: /visit/tickets

Статическая страница с текстом на несколько тысяч знаков и несколько изображений. Смотри описание [статических страниц][tech-staticpages].

## <a name="visit/etiquette"></a> Этикет
>	url: /visit/etiquette

Статическая страница с текстом на несколько тысяч знаков и несколько изображений. Смотри описание [статических страниц][tech-staticpages].

## <a name="visit/directions"></a> Как добраться
>	url: /visit/directions

Статическая страница с картой и небольшим пояснительным текстом. Смотри описание [статических страниц][tech-staticpages].

## <a name="visit/watch"></a> Презентационный ролик
>	url: /visit/watch

Статическая страница. Смотри описание [статических страниц][tech-staticpages].

# <a name="press"></a> Пресс-клуб
>	url: /press

При нажатии на ссылку [Пресс-клуб][press] должно происходить внутреннее (скрытое от пользователя, т.е. в адресной строке должен отображаться адрес страницы «Пресс-клуб») перенаправление на страницу [Новости][press/articles].

## <a name="press/articles"></a> Новости
>	url: /press/articles

Новости показываются в виде списка, каждый элемент которого содержит `название`, `метки`, `дату привязки` и `краткое описание` (анонс). Если ресурс «Новость» является полным, то название новости становится ссылкой.

На странице /press/articles показываются новости с начала июля предшествующего текущей дате (в расчёт берётся атрибут `дата привязки`) а также все события, привязанные к датам в будущем.

 Рядом нужно расположить индекс по годам. При щелчке на год показываются ВСЕ новости за указанный год (url: /press/articles/y&lt;year&gt; префикс y используется что-бы небыло пересечения с id новости).

При такой организации разбивка по страницам не потребуется.

### _Администрирование раздела «Новости»_

Новости в интерфейсе администрирования выводятся в виде таблицы со следующими колонками:

* Название (Заголовок новости)
* Метки
* Признак полноты ресурса
* Статус (см. [описание типовых ресурсов][tech-resources])

Должна быть возможность фильтрации и сортировка таблицы по перечисленным колонкам.

<!-- `TODO` возможно стоит по-умолчанию создавать новость со статусом _опубликован_? -->

#### <a name="press/articles/attributes"></a> _Атрибуты ресурса «Новость»_

Наследуется от статической страницы

* Название _Унаследован от ресурса «Статическая страница»_
* Краткое описание (Анонс) _Унаследован от ресурса «Статическая страница»_
* Блоки (Текст статьи) _Унаследован от ресурса «Статическая страница»_
* Метки
* Дата публикации
* Дата привязки

Атрибуты `Название` и `Краткое описание` являются обязательными.

Новость считается _полной_, если заполнены все обязательные поля и есть 1 непустой текстовый блок (Текст статьи).

##### Атрибут `Краткое описание` (Анонс)
Желателен к заполнению. Для редактирования атрибута используется [умеренный текстовый редактор][tech-editor-medium].

##### Атрибут `Блоки` (Текст статьи)
Т.к. ресурс «Новость» наследован от ресурса «[Статическая страница][tech-staticpages]», то способ редактирования тот-же. Но для целей ресурса «Новость» фиксируется количество блоков — 1 и тип блока — текстовый, в который вводится текст статьи.

> Возможно по требованию дизайна количество блоков и их тип нужно будет изменить.

##### Атрибут `Метки`
Набор текстовых меток. Как правило метка будет всего одна.

##### Атрибут `Дата публикации`
Дата, когда ресурс «новость» был переведён в статус _опубликован_.

##### Атрибут `Дата привязки`
Дата к которой новость привязана, т.е. дата когда должно совершиться событие, описываемое в новости.

### Страница «Новость»
>	url: /press/articles/<id>

Этот адрес доступен только для _полных_ ресурсов.

На странице новости показывается заголовок новости, метки и блоки (основное содержимое)

## <a name="press/proscenium"></a> PROсцениум
>	url: /press/proscenium

PROсцениум — это театральная газета, выпускаемая при содействии Молодёжного театра на фонтанке.

В этом разделе сайта предполагается публиковать выпуски газеты в PDF формате.

На странице должен отображаться список выпусков, отсортированный по дате выхода номера (самый свежий выпуск на самом верху).

Каждый элемент списка должен содержать месяц и год выпуска (название выпуска), краткое описание выпуска и ссылку на скачивание всего номера. Название выпуска может служить ссылкой если ресурс _полный_.

На странице /press/proscenium показываются последние 10 выпусков.

Рядом нужно расположить индекс по годам. При щелчке на год показываются ВСЕ выпуски за указанный год (url: /press/proscenium/y&lt;year&gt; префикс y используется что-бы небыло пересечения с id новости).

При такой организации разбивка по страницам не потребуется. 

### _Администрирование раздела «PROсцениум»_

На странице администрирования раздела «PROсцениум» отображается список выпусков, отсортированный по дате выхода. В таблице показываются следующие столбцы:

* Название выпуска
* Дата выпуска
* Статус

#### _Атрибуты ресурса «Выпуск PROсцениум»_

Ресурс «Выпуск PROсцениум» наследуется от ресурса «[Статическая страница][tech-staticpages]», от которого наследуются атрибуты: «Название», «Краткое описание», «Блоки». 

* Название. _Унаследован от ресурса «Статическая страница»_
* Краткое описание. _Унаследован от ресурса «Статическая страница»_
* Блоки (Пополосное описание). _Унаследован от ресурса «Статическая страница»_
* Дата выпуска
* Ссылка на pdf ффайл

Атрибуты `Дата выпуска`, `Краткое описание` и `Ссылка на pdf ффайл` являются обязательными к заполнению.

Ресурс считается полным если в дополнение к обязательным атрибутам заполнен атрибут `Блоки (Пополосное описание)` (хотя-бы один блок текстовой информации).

##### Атрибут `Название`
Название этого ресурса формируется автоматически по атрибуту `Дата выпуска`, например: «Апрель 2012». Пользователь может отредактировать его, но при смене значения атрибута `Дата выпуска` этот атрибут должен обновляться.

##### Атрибут `Краткое описание`
В кратком описании будут описываться основные темы номера. Текст редактируется [умеренным текстовым редактором][tech-editor-medium].

##### Атрибут `Блоки (Пополосное описание)`
Т.к. ресурс «Выпуск PROсцениум» наследован от ресурса «[Статическая страница][tech-staticpages]», то способ редактирования тот-же. Пользователю предлагается набор заготовленных названий текстовых блоков:

* 1-я полоса
* 2-я и 3-я полоса
* 4-я и 5-я полоса
* 6-я и 7-я полоса
* 8-я и 9-я полоса
* 10-я и 11-я полоса
* 12-я полоса

Остальные блоки можно добавить, если потребуется. Весь список предопределённых названий блоков можно отредактировать добавив или удалив названия.

Предполагается что в каждом из блоков будет находится развёрнутое описание полосы или разворота, возможно со ссылкой на скачивание отдельной полосы. Ссылки на скачивание можно будет вставить через текстовый редактор.

##### Атрибут `Дата выпуска`
Дата выпуска номера газеты. Можно задать с точностью до дня.

### Страница выпуска газеты PROсцениум
>	url: /press/proscenium/<date>

На странице выпуска будет показано название выпуска, ссылка на скачивание и все блоки в которых находятся описания полос или разворотов.

## <a name="press/molodezhka"></a> Молодёжка
>	url: /press/molodezhka

>	url: /press/молодёжка

>	url: /press/молодежка

Молодёжка — это выпускаемый ранее интернет журнал Молодёжного театра на фонтанке. Ныне этот журнал не выпускается, так что этот раздел будет служить архивом.

В этом разделе сайта будут опубликованы выпуски журнала в виде статических страниц.

На странице должен отображаться список выпусков, отсортированный по дате выхода номера (самый свежий выпуск на самом верху).

Каждый элемент списка должен содержать месяц и год выпуска (название выпуска), краткое описание выпуска и ссылку на просмотр всего номера. Название выпуска может служить ссылкой если ресурс _полный_.

На странице /press/molodezhka показываются последние 10 выпусков.

Рядом нужно расположить индекс по годам. При щелчке на год показываются ВСЕ выпуски за указанный год (url: /press/molodezhka/y&lt;year&gt; префикс y используется что-бы небыло пересечения с id новости).

При такой организации разбивка по страницам не потребуется. 

### _Администрирование раздела «Молодёжка»_

На странице администрирования раздела «Молодёжка» отображается список выпусков, отсортированный по дате выхода. В таблице показываются следующие столбцы:

* Название выпуска
* Дата выпуска
* Статус

#### _Атрибуты ресурса «Выпуск Молодёжки»_

Ресурс «Выпуск Молодёжки» наследуется от ресурса «[Статическая страница][tech-staticpages]», от которого наследуются атрибуты: «Название», «Краткое описание», «Блоки». 

* Название. _Унаследован от ресурса «Статическая страница»_
* Краткое описание. _Унаследован от ресурса «Статическая страница»_
* Блоки (Содержимое номера). _Унаследован от ресурса «Статическая страница»_
* Дата выпуска

Атрибуты `Дата выпуска`, `Краткое описание` и `Блоки (Содержимое номера)` (хотя-бы один блок текстовой информации) являются обязательными к заполнению.

##### Атрибут `Название`
Название этого ресурса формируется автоматически по атрибуту `Дата выпуска`, например: «Апрель 2012». Пользователь может отредактировать его, но при смене значения атрибута `Дата выпуска` этот атрибут должен обновляться.

##### Атрибут `Краткое описание`
В кратком описании будут описываться основные темы номера. Текст редактируется [умеренным текстовым редактором][tech-editor-medium].

##### Атрибут `Блоки (Содержимое номера)`
Т.к. ресурс «Выпуск Молодёжки» наследован от ресурса «[Статическая страница][tech-staticpages]», то способ редактирования тот же. Набор блоков произволен. Для размещения дополнительных материалов можно пользоваться разделом «[Страницы][pages]».

##### Атрибут `Дата выпуска`
Дата выпуска номера журнала. Можно задать с точностью до дня.

### Страница выпуска журнала Молодёжка
>	url: /press/molodezhka/<date>

>	url: /press/молодёжка/<date>

>	url: /press/молодежка/<date>

На странице выпуска будет показано название выпуска и все блоки в которых находятся содержимое выпуска.

## <a name="press/media-digest"></a> Дайджест СМИ
>	url: /press/media-digest

В этом разделе сайта будут опубликованы интересные статьи в виде статических страниц.

На странице раздела должен отображаться список интересных статей, отсортированный по дате выхода (самая свежая на самом верху).

Каждый элемент списка содержит название выпуска, месяц и год выхода, краткое описание статьи и ссылку на просмотр всей статьи (если ресурс _полный_).

Название статьи будет служить ссылкой если ресурс _полный_ или если заполнен атрибут `Ссылка на статью`. Поведение ссылки примерно следующее: если ресурс _не полный_, но заполнен атрибут `Ссылка на статью`, то ссылка с название будет вести на эту статью в интернете (главное визуально показать, что ссылка ведёт на внешний ресурс). Если ресурс _полный_, то поведение стандартное, а ссылка на оригинальную статью размещается на странице ресурса «Статья СМИ».

На странице /press/media-digest показываются последние 20 статей.

Рядом нужно расположить индекс по годам. При щелчке на год показываются ВСЕ статьи за указанный год (url: /press/media-digest/y&lt;year&gt; префикс y используется что-бы небыло пересечения с id новости).

При такой организации разбивка по страницам не потребуется. 

### _Администрирование раздела «Дайджест СМИ»_

На странице администрирования раздела «Дайджест СМИ» отображается список выпусков, отсортированный по дате выхода. В таблице показываются следующие столбцы:

* Название статьи
* Издание
* Дата выхода
* Статус

#### _Атрибуты ресурса «Статья СМИ»_

Ресурс «Статья СМИ» наследуется от ресурса «[Статическая страница][tech-staticpages]», от которого наследуются атрибуты: «Название», «Краткое описание», «Блоки». 

* Название. _Унаследован от ресурса «Статическая страница»_
* Краткое описание. _Унаследован от ресурса «Статическая страница»_
* Блоки (Содержимое статьи). _Унаследован от ресурса «Статическая страница»_
* Дата выхода
* Издание
* Ссылка на статью

Атрибуты `Дата выпуска`, `Название`, `Краткое описание` и `Издание` являются обязательными к заполнению.

Ресурс считается _полным_ если заполнен атрибут `Блоки (Содержимое номера)` (хотя-бы один блок текстовой информации).

##### Атрибут `Название`
Название статьи.

##### Атрибут `Краткое описание`
В кратком описании можно разместить ЛИД статьи. Текст редактируется [умеренным текстовым редактором][tech-editor-medium].

##### Атрибут `Блоки (Содержимое статьи)`
Т.к. ресурс «Статья СМИ» наследован от ресурса «[Статическая страница][tech-staticpages]», то способ редактирования тот же. Набор блоков произволен. Для размещения дополнительных материалов можно пользоваться разделом «[Страницы][pages]».

Предполагается, что если исходная статья находится в интернете, то этот атрибут не имеет смысла заполнять.

##### Атрибут `Дата выхода`
Дата выхода статьи. Можно задать с точностью до дня.

##### Атрибут `Издание`
Название издания в котором была опубликована статья.

##### Атрибут `Ссылка на статью`
Если статья расположена в интернете, то нужно заполнить этот атрибут.

### Страница Статьи СМИ
>	url: /press/media-digest/<id>

На странице статьи будет показано название статьи, ссылка на исходную статью в интерете (если заполнена) и все блоки в которых находятся содержимое статьи.

------------------

# Вспомогательные разделы

## <a name="search"></a> Поиск

Результаты поиска показываются списком со ссылками на найденные ресурсы (если ресурс _полный_) и выдержками текста из ресурса, которые содержат исходную фразу. Поиск производится только по _опубликованным_ ресурсам.

Результаты поиска можно отфильтровать по разделам главного меню к которым относятся найденные ресурсы.

Индексируются можно как _опубликованные_ так и _неопубликованные_ ресурсы, но непосредственно поиск производится только по _опубликованным_. Для индексации можно пользоваться например [Sphinx](http://en.wikipedia.org/wiki/Sphinx_(search_engine)) или [Lucene](http://en.wikipedia.org/wiki/Lucene). Индексировать содержимое файлов не требуется, только ресурсов.

## <a name="pages"></a> Страницы
>	url: /pages

Эта страница доступна только администраторам. 

Набор статических страниц, которые не могут быть отнесены ни к одному из приведённых выше разделов. Эти страниц будут использованы для того что-бы разместить некоторую дополнительную информацию на которую можно сослаться, например, из новости.

Описание атрибутов статических страниц смотри в разделе [технические замечания][tech-staticpages].

### _Администрирование раздела «Страницы»_

На странице администрирования раздела «Страницы» выводится их список в виде таблицы со следующими полями:

* Название
* Статус

Щёлкнув по названию производится переход на страницу редактирования «Страницы».

### <a name="pages/id"></a> Страница
>	url: /pages/<id>

Для отображения статической страницы используется представление по-умолчанию. Возможно нечто похожее на развёрнутую статью новости.

## <a name="filespage"></a> Файлы
>	url: /files

Эта страница доступна только администраторам. 

### _Администрирование раздела «Файлы»_

На странице администрирования раздела «Файлы» выводится их список в виде таблицы со следующими полями:

* Название файла (если нет название, то имя файла)
* Тип файла
* Размер файла
* Статус

По умолчанию в списке отображаются только те файлы, которые ещё не привязаны ни к одному ресурсу (т.е. нет ссылок на этот файл ни из одного ресурса). Но можно отключить этот фильтр и показать полный список.

При нажатии на название файла происходит переход на страницу /files/&lt;id&gt; на которой отображается подробная информация о файле:

* Название (если есть)
* Имя файла (с расширением)
* Тип файла (Видео / Аудио / Документ / Изображение) _определяется по MimeType_
* MimeType файла
* Размер файла
* Краткое описание
* Список ресурсов где есть ссылки на этот файл (ресурс)
* Ссылка для скачивания

К ресурсу «Файл» можно обратиться 3-мя способами:

1. По ссылке /files/&lt;id&gt;. Этот способ доступен только администраторам сайта.
2. По ссылке /files/&lt;id&gt;/download. Эта ссылка формируется автоматически при отображении любой страницы, если она находится в атрибуте href тега &lt;a&gt; или &lt;link&gt;.
3. По ссылке /files/&lt;id&gt;/inline. Эта ссылка формируется автоматически при отображении любой страницы, если она находится в любом другом атрибуте, кроме того, что обозначен выше.

`ПРИМЕЧАНИЕ` Необходимо заметить, что при написании текстов пользователь вводит 1-й вариант адреса и только при отображении он преобразуется во 2-й или 3-й.

#### _Атрибуты ресурса «Файл»_

* Название (краткое и ёмкое описание файла в 3-4 слова)
* Имя (это то-же имя, которое имел файл на файловой системе пользователя)
* MimeType (image/png, video/flv, video/mpeg, application/pdf ...)
* Краткое описание (вводится с помощью [умеренного редактора][tech-editor-medium])

------------------

# <a name="tech"></a> Некоторые технические замечания

## <a name="tech-resources"></a> Ресурсы

Все ресурсы могут находиться в статусе _опубликован_, _неопубликован_, _черновик_ (служебный статус, который не может быть напрямую изменён пользователем. См. описание ниже). По умолчанию выставляется статус _неопубликован_. При переводе ресурса из статуса _неопубликован_ в _опубликован_, а также при каждом обновлении опубликованного ресурса, автору должен быть показан предпросмотр. В предпросмотре, помимо самих данных, может быть показана некоторая служебная информация, например — ссылки, которые были удалены из текстового содержимого из-за того, что ресурсы, на которые они ссылаются, находятся в статусе _неопубликован_ (см. описание текстового редактора) или являются неполными.

Для каждого типа ресурсов будет отдельно указано, что означает _неполный_ ресурс. Если эта информация не указана, то ресурс считается _полным_ если заполнены все обязательные поля.

При создании ресурса в модели прописывается дата его создания и дата последнего обновления, равная дате его создания. При последующих обновлениях меняется дата последнего обновления.

При создании и редактировании ресурсов обязательно наличие предпросмотра.

Для более удобного создания ресурсов предлагается следующая схема: пользователю при создании любого ресурса предлагаются кнопки «Создать», «Создать и Опубликовать» или «Сохранить и снять с публикации», «Сохранить и Опубликовать» и «Отмена».

Если ресурс _не опубликован_, то он отображается __только__ в таблице со списком подобных ресурсов (где отображается статус ресурса). Ссылки, которые были установлены на ресурс пока он находился в статусе _опубликован_ не должны удаляться. При показе такие ссылки в интерфейсе конечного пользователя должны быть неактивными. Важно учесть, что при изменении ранее созданной ссылки в редакторе (или в «блоке с данными») элемент, на который установлена ссылка должен всегда присутствовать в списке редактирования, даже если редактируется ранее созданная ссылка на ресурс, которыя в момент изменения находится в статусе _не опубликован_.

Если ресурс _опубликован_, то в зависимости от того _полный_ он или нет, ссылки на него в интерфейсе конечного пользователя должны быть активными или нет соответственно. Все _опубликованные_ ресурсы всегда показываются в редакторе (при установке/редактировании ссылок) и при создании/изменении «блока с данными».

Ресурс можно удалить, только если на него нет ссылок. Если есть ресурсы, ссылающиеся на удаляемый объект, то можно только перевести его в статус _не опубликован_.

Приятным бонусом будет автосохранение редактируемого и создаваемого ресурса в новую модель со статусом _черновик_. Черновик должен иметь ссылку на ресурс с которым он связан. Если подобной ссылки нет, то считается что черновик был создан для нового ресурса.

Все ресурсы наследуются от этого базового ресурса.

Примеры ресурсов:

* Актёр
* Спектакль
* Новость (статья)
* Статическая страница (страница истории и т.п.)
* Блок с данными

### <a name="tech-drafts"></a> Механизм работы с черновиками

Если черновик не имеет ссылки на ресурс, то подобные черновики должны выводиться в интерфейсе редактирования однотипных ресурсов (актёры, спектакли, новости, блоки с данными), помеченные особым образом и удаляться если на основе черновика был создан ресурс, по запросу пользователя либо через определённое время (например 30 дней).

Если черновик ссылается на какой-либо ресурс, то при открытии его на редактирование пользователь должен быть предупреждён о наличии черновика (черновиков), если черновик имеет более свежую дату модификации. Черновик удаляется если ресурс имеет более свежую дату модификации, или по запросу пользователя, или через определённое время (например 30 дней).

## <a name="tech-editor"></a> Текстовый редактор

### <a name="tech-editor-large"></a> Полный вариант

Если не указано иное, то для редактирования текстов в интерфейсе администрирования следует использовать редактор с минимальными возможностями:

* заголовки (`<h2>` ... `<h6>`. `<h1>` — отсутствует!)
* выделение (`<em title="">`)
* сильное выделение (`<strong title="">`)
* разделяющая линия (`<hr>`)
* параграф (`<p>`) должен вставляться автоматически при нажатии _Enter_
* нумерованный / ненумерованный список (`<ol>` / `<ul>` → `<li>`) (для тегов `<ol>` и `<ul>` разрешается атрибут @start)
* изображение с подписью (`<figure>`, `<figcaption>`, `<img width="" height="" alt="" align="" src="" title="">`, `<video width="" height="" src="">`, `<audio src="">`). Для вставки видео в отрендереный html предлагаю использовать тег `<video>`, а потом с помощь JavaScript преобразовывать его в `<object>` с flash проигрываетлем, если браузер не поддерживает html5 video или предоставленный формат видео. Для медиа элемента можно задать заголовок прямо в интерфейсе редактора. Все медиа элементы должны попадать в общую [базу файлов][files]. Либо они могут быть выбраны из этой базы (с фильтрацией по типу)
* блочная цитата (`<blockquote>`)
* внутристрочная цитата (`<q title="">`)
* отсыл к результату труда, например название книги, постановки или пьесы. Это может быть цитата из пьесы либо просто её упоминание (`<cite title="">`). [Подробнее](http://html5doctor.com/element-index/#cite)
* надстрочный и подстрочный индекс (`<sub title="">`, `<sup title="">`)
* ссылки (`<a href="" title="">`) должна быть возможность вставки ссылки как на внешние ресурсы (абсолютный url) так и внутренние ресурсы (страница актёра, страница спектакля, страница новости, статическая страница, файл и т.п. Вообще любой внутренний url является идентификатором ресурса). При использовании внутренних ссылок должна быть возможность устанавливать ссылки как на опубликованные ресурсы, так и на находящиеся в разработке. Тогда при преобразовании текста в `html` ссылки, ссылающиеся на неопубликованные ресурсы должны удаляться (см. более подробное описание в разделе _Ресурсы_). Возможны способ создания и обработки ссылок смотри раздел [ссылки на ресурсы][tech-links].

<!-- `TODO` Может быть удастся придумать так, что можно будет прямо в текстовом редакторе создавать галереи. -->

### <a name="tech-editor-medium"></a> Умеренный вариант

* выделение (`<em>`)
* сильное выделение (`<strong>`)
* параграф (`<p>`)
* нумерованный / ненумерованный список (`<ol>` / `<ul>` → `<li>`)
* блочная цитата (`<blockquote>`)
* внутристрочная цитата (`<q>`)
* отсыл к результату труда, например название книги, постановки или пьесы. Это может быть цитата из пьесы либо просто её упоминание (`<cite>`). [Подробнее](http://html5doctor.com/element-index/#cite)
* надстрочный и подстрочный индекс (`<sub>`, `<sup>`)
* ссылки (`<a>`)

### <a name="tech-editor-small"></a> Облегчённый вариант

* выделение (`<em>`)
* сильное выделение (`<strong>`)
* внутристрочная цитата (`<q>`)
* отсыл к результату труда, например название книги, постановки или пьесы. Это может быть цитата из пьесы либо просто её упоминание (`<cite>`). [Подробнее](http://html5doctor.com/element-index/#cite)
* надстрочный и подстрочный индекс (`<sub>`, `<sup>`)
* ссылки (`<a>`)

## <a name="tech-staticpages"></a> Статические страницы

Ресурс «статическая страница» имеет следующие атрибуты

* Название
* Краткое описание
* Блоки

Атрибут `Название` почти везде фиксирован кроме случаев использования в разделе «Страницы».

Для редактирования атрибута `Краткое описание` используется [умеренный текстовый редактор][tech-editor-medium].

Блоки могут быть следующих типов:

* блок-контейнер
* блок текстовой информации
* блок медиа информации (видео, аудио, фотографии), также можно назвать как блок-галерея.
* блок-карта (скорее всего Yandex, т.к. на спутниковой карте Google большая сцена в недостроенном виде)
* может быть что-то ещё

Блок-контейнер может содержать внутри себя любые блоки, в том числе и блок-контейнер (т.е. структура рекурсивная).

Блоки текстовой информации редактируются [полным текстовым редактором][tech-editor-large].

Порядок задания блоков важен (поэтому должна быть возможность менять порядок блоков на странице администрирования статических страниц). Он будет использован при отображении в шаблоне по умолчанию (default view) для статических страниц.

Каждому из этих блоков может быть дано название (впоследствии это название будет преобразовано в html атрибут id путём замены пробелов на дефис.  [Формат идентификатора в html5][html5-id-spec] или [более понятно](http://mathiasbynens.be/notes/html5-id-class)). Название может быть использовано при отображении блоков. Уровень заголовка (h2 – h6) зависит от уровня вложенности блока.

Для каждой статической страницы может быть создан свой view. В него должен быть передан список блоков с их названиями в том порядке, в котором их расположил автор. Далее верстальщик на основании названий блоков сможет адекватно сверстать страницы для которых потребуется нестандартная вёрстка. Нет необходимости давать возможность создавать и редактировать подобные view через веб интерфейс, т.к. те, кто будут создавать такие view должны иметь достаточную квалификацию для работы с исходным кодом проекта.

Медиа файлы для блока медиа информации могут быть взяты из общей [базы файлов][files]. Либо загружены прямо в интерфейсе создания блока (тогда должна быть возможность ввода заголовка).

При сохранении статической страницы обязательно должен быть показан предпросмотр.

### Пример

Есть страница [история][about/history], логически разбитая на 3 блока. У каждого из блоков есть название (Малыщицкий, Падве, Спивак). Внутри блока находятся галерея изображений и текстовый блок. Можно организовать подобную структуру добавив три блока-контейнера с заголовками Малыщицкий, Падве и Спивак. Внутри каждого блока-контейнера один блок медиа информации и один блок текстовой информации.

## <a name="tech-links"></a> Ссылки на ресурсы

В текстовом редакторе, а также во многих моделях можно сослаться на внутренний или внешний ресурс. Это делается с помощью гиперссылок.

Гиперссылки могут быть вставлены пользователем в любом виде – полный URL (http://yandex.ru) или неполный (относительный «../path/to/smth» или абсолютный «/absolute/path»). Относительные пути мы не будем рассматривать.

Каждый ресурс на сайте имеет свой URL, например /press/articles/&lt;id&gt;, который указывает на новость. Этот адрес может быть вставлен пользователем несколькими способами:

1. /press/articles/&lt;id&gt;
2. http://mtfontanka.spb.ru/press/articles/&lt;id&gt;
3. //mtfontanka.spb.ru/press/articles/&lt;id&gt;
4. mtfontanka.spb.ru/press/articles/&lt;id&gt;

Т.е. при вставке ссылки система должна сначала привести её к «каноническому» виду (1-й вариант) путём удаления названия протокола, двойного слеша и доменного имени (доменных имён может быть несколько, возможные варианты перечислены в [соответствующем разделе][possible-domain-names]). Если ссылку не удалось привести к каноническому виду, то считаем её внешней.

Ссылки на внешние ресурсы должны открываться в новом окне.

<!--

------------------
[Остальные мысли в сыром виде](pool.md)
-->

[possible-domain-names]: #possible-domain-names
[about]: #about
[about/in-brief]: #about/in-brief
[about/mission]: #about/mission
[about/history]: #about/history
[about/legendary-plays]: #about/legendary-plays
[about/technical-equipment]: #about/technical-equipment
[about/friends]: #about/friends
[performances]: #performances
[performances/attrs/timespans]: #performances/attrs/timespans
[performances/current]: #performances/current
[performances/all]: #performances/all
[performances/upcoming]: #performances/upcoming
[timetable]: #timetable
[persons]: #persons
[get-in-touch]: #get-in-touch
[get-in-touch/contacts]: #get-in-touch/contacts
[get-in-touch/feedback]: #get-in-touch/feedback
[visit]: #visit
[visit/tickets]: #visit/tickets
[visit/schemas]: #visit/schemas
[visit/etiquette]: #visit/etiquette
[visit/directions]: #visit/directions
[visit/watch]: #visit/watch
[press]: #press
[press/articles]: #press/articles
[press/articles/attributes]: #press/articles/attributes
[press/proscenium]: #press/proscenium
[press/molodezhka]: #press/molodezhka
[press/media-digest]: #press/media-digest
[press/photo]: #press/photo
[search]: #search

[files]: #filespage
[pages]: #pages
[tech]: #tech
[tech-resources]: #tech-resources
[tech-editor-large]: #tech-editor-large
[tech-editor-medium]: #tech-editor-medium
[tech-editor-small]: #tech-editor-small
[tech-staticpages]: #tech-staticpages
[tech-links]: #tech-links
[tech-todolist]: #tech-todolist

[html5-id-spec]: http://www.w3.org/TR/html5/elements.html#the-id-attribute